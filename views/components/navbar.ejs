<!--
    AIRBNB-STYLE NAVIGATION BAR
    ===========================
    
    Features:
    - Logo on the left
    - Prominent search bar in the center
    - User menu and host button on the right
    - Fully responsive design
-->
<nav class="airbnb-navbar">
    <div class="container">
        <!-- Logo -->
        <a href="/" class="airbnb-logo">
            <i class="fa-solid fa-compass"></i>
            <span class="d-none d-md-inline">TripNest</span>
        </a>

        <!-- Central Search Bar -->
        <div class="airbnb-search d-none d-lg-flex">
            <input type="text" placeholder="Search destinations" id="navSearchInput">
            <button class="airbnb-search-btn" onclick="searchListings()">
                <i class="fas fa-search"></i>
            </button>
        </div>

        <!-- Right Side Actions -->
        <div class="airbnb-nav-actions">
            <% if (typeof currentUser !== 'undefined' && currentUser) { %>
                <a href="/listings/new" class="airbnb-host-btn">
                    <i class="fas fa-home me-1"></i>
                    <span class="d-none d-md-inline">TripNest your home</span>
                </a>
            <% } else { %>
                <a href="/auth/signup" class="airbnb-host-btn">
                    <i class="fas fa-home me-1"></i>
                    <span class="d-none d-md-inline">TripNest your home</span>
                </a>
            <% } %>

            <!-- User Menu -->
            <div class="dropdown">
                <button class="airbnb-menu-btn" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="fas fa-bars"></i>
                    <div class="airbnb-avatar">
                        <% if (typeof currentUser !== 'undefined' && currentUser) { %>
                            <%= (currentUser.username || currentUser.email || 'U').charAt(0).toUpperCase() %>
                        <% } else { %>
                            <i class="fas fa-user"></i>
                        <% } %>
                    </div>
                </button>
                
                <ul class="dropdown-menu dropdown-menu-end shadow border-0 rounded-3 mt-2" style="min-width: 240px;">
                    <% if (typeof currentUser !== 'undefined' && currentUser) { %>
                        <!-- Authenticated User Menu -->
                        <li class="px-3 py-2 border-bottom">
                            <small class="text-muted d-block">Signed in as</small>
                            <strong><%= currentUser.username || currentUser.email || 'User' %></strong>
                        </li>
                        <li><a class="dropdown-item py-2" href="/listings">
                            <i class="fas fa-list me-2"></i>All Listings
                        </a></li>
                        <li><a class="dropdown-item py-2" href="/listings/new">
                            <i class="fas fa-plus me-2"></i>Add Listing
                        </a></li>
                        <li><hr class="dropdown-divider my-1"></li>
                        <li><a class="dropdown-item py-2" href="/listings">
                            <i class="fas fa-user-circle me-2"></i>My Profile
                        </a></li>
                        <li><a class="dropdown-item py-2" href="/listings">
                            <i class="fas fa-building me-2"></i>My Listings
                        </a></li>
                        <li><hr class="dropdown-divider my-1"></li>
                        <li>
                            <form action="/auth/logout" method="GET" class="d-inline w-100">
                                <button type="submit" class="dropdown-item py-2 text-danger">
                                    <i class="fas fa-sign-out-alt me-2"></i>Logout
                                </button>
                            </form>
                        </li>
                    <% } else { %>
                        <!-- Unauthenticated User Menu -->
                        <li><a class="dropdown-item py-2 fw-bold" href="/auth/signup">Sign up</a></li>
                        <li><a class="dropdown-item py-2" href="/auth/login">Log in</a></li>
                        <li><hr class="dropdown-divider my-1"></li>
                        <li><a class="dropdown-item py-2" href="/listings">Browse Listings</a></li>
                        <li><a class="dropdown-item py-2" href="/">Help</a></li>
                    <% } %>
                </ul>
            </div>
        </div>
    </div>

    <!-- Mobile Search Bar -->
    <div class="container d-lg-none mt-3">
        <div class="airbnb-search w-100">
            <input type="text" placeholder="Search destinations" id="navSearchInputMobile">
            <button class="airbnb-search-btn" onclick="searchListings()">
                <i class="fas fa-search"></i>
            </button>
        </div>
    </div>
</nav>

<script>
function searchListings() {
    const searchInput = document.getElementById('navSearchInput') || document.getElementById('navSearchInputMobile');
    const query = searchInput.value.trim();
    if (query) {
        window.location.href = `/listings?search=${encodeURIComponent(query)}`;
    } else {
        window.location.href = '/listings';
    }
}

// Allow search on Enter key
document.addEventListener('DOMContentLoaded', function() {
    const searchInputs = document.querySelectorAll('#navSearchInput, #navSearchInputMobile');
    searchInputs.forEach(input => {
        if (input) {
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchListings();
                }
            });
        }
    });
});
</script>